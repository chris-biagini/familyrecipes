<%# Helper for HTML escaping -%>
<%- h = ->(text) { ERB::Util.html_escape(text) } -%>

<%# Page-specific styles for the grocery list builder -%>
<%- extra_styles = '  <link rel="stylesheet" href="groceries.css">' -%>

<%= render.call('head', title: 'Biagini Family Recipes: Menu', extra_head: extra_styles, base_path: '../') %>

<body>
<%= render.call('nav') %>

  <main>
    <header id="menu-header">
      <h1>Menu</h1>
    </header>

    <noscript>
      <p><em>This page works without JavaScript, but consider enabling it if you would like to generate a custom list from selected recipes.</em></p>
    </noscript>

    <p id="instructions" class="hidden-until-js">Select the recipes you're planning to make, then print this page to get a printable menu and grocery list.</p>

    <div id="recipe-selector" class="hidden-until-js">
      <%- regular_recipes.each do |category, recipes| -%>
      <div class="category">
        <h2><%= category %></h2>
        <ul>
        <%- recipes.each do |recipe| -%>
          <li>
            <input type="checkbox" id="<%= recipe.id %>-checkbox" data-title="<%= h.call(recipe.title) %>" data-ingredients="<%= h.call(recipe.all_ingredient_names.to_json) %>">
            <label for="<%= recipe.id %>-checkbox" title="Ingredients: <%= h.call(recipe.all_ingredient_names.join(', ')) %>"><%= recipe.title %></label>
            <a href="<%= recipe.id %>" class="recipe-link" title="Open <%= recipe.title %> in new tab" target="_blank">â†’</a>
          </li>
        <%- end -%>
        </ul>
      </div>
      <%- end -%>

      <%- if quick_bites_by_subsection.any? -%>
      <div class="quick-bites">
        <h2>Quick Bites</h2>
        <div class="subsections">
          <%- quick_bites_by_subsection.each do |subsection, items| -%>
          <div class="subsection">
            <h3><%= subsection %></h3>
            <ul>
            <%- items.each do |item| -%>
              <li>
                <input type="checkbox" id="<%= item.id %>-checkbox" data-title="<%= h.call(item.title) %>" data-ingredients="<%= h.call(item.all_ingredient_names.to_json) %>">
                <label for="<%= item.id %>-checkbox" title="Ingredients: <%= h.call(item.all_ingredient_names.join(', ')) %>"><%= item.title %></label>
              </li>
            <%- end -%>
            </ul>
          </div>
          <%- end -%>
        </div>
      </div>
      <%- end -%>
    </div>

    <div id="freeform-section" class="hidden-until-js">
      <h2>Additional Items</h2>
      <textarea id="freeform-entries" rows="6" placeholder="Add extra items here, one per line..."></textarea>
      <p class="hint">These will be added to your grocery list when you print.</p>
    </div>

    <div id="grocery-preview" class="hidden-until-js">
      <div id="grocery-preview-header">
        <h2>Shopping List</h2>
        <span class="item-count" id="item-count"></span>
      </div>
      <p id="grocery-preview-empty">Select recipes above to build your shopping list.</p>

      <header id="print-grocery-header" style="display: none;">
        <h1>Grocery List</h1>
      </header>

      <section id="grocery-list">
      <%- ingredient_database.each do |aisle, ingredients| -%>
      <%- aisle_hidden = (aisle == "Omit_From_List") ? ' style="display:none"' : '' -%>
      <div class="aisle"<%= aisle_hidden %>>
        <h3><%= aisle %></h3>
        <ul>
          <%- ingredients.each do |ingredient| -%>
            <li><%= ingredient[:name] %></li>
          <%- end -%>
        </ul>
      </div>
      <%- end -%>

      <div class="aisle">
        <h3>Miscellaneous</h3>
        <ul id="misc-items"></ul>
      </div>
    </section>
    </div>

    <div id="notes-section">
      <h3>Notes</h3>
      <div class="notes-lines"></div>
    </div>
  </main>

<script src="groceries.js" defer></script>

</body>
</html>
