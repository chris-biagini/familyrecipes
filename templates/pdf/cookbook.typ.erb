// Cookbook generated by FamilyRecipes — do not edit directly.

// ── Design Tokens ──

#let wine-red = rgb(155, 10, 25)
#let text-color = rgb(50, 50, 50)
#let muted = rgb(100, 100, 100)
#let rule-color = luma(200)

// ── Base Setup ──

#set page(
  paper: "us-letter",
  margin: (top: 1in, bottom: 1in, left: 1.25in, right: 1.25in),
)

#set text(font: "Libre Bodoni v2002", size: 11pt, fill: text-color)

#show heading.where(level: 1): it => {
  text(font: "Jost*", size: 24pt, weight: "bold", fill: wine-red, tracking: 0.1em)[#upper(it.body)]
}

#show heading.where(level: 2): it => {
  text(font: "Jost*", size: 18pt, weight: "bold", fill: wine-red)[#it.body]
}

#show heading.where(level: 3): it => {
  v(0.75em)
  text(font: "Jost*", size: 13pt, weight: "bold", fill: text-color, tracking: 0.08em)[#upper(it.body)]
  v(0.3em)
  line(length: 100%, stroke: 0.5pt + rule-color)
  v(0.5em)
}

#let page-ref(label) = context {
  let loc = query(label).first().location()
  link(loc)[#numbering("1", ..counter(page).at(loc))]
}

// ── Title Page ──

#page(numbering: none)[
  #align(center + horizon)[
    #text(font: "Jost*", size: 24pt, weight: "bold", fill: wine-red, tracking: 0.15em)[OUR RECIPES]
    #v(0.5em)
    #line(length: 30%, stroke: 0.75pt + wine-red)
    #v(0.5em)
    #text(style: "italic", size: 14pt, fill: muted)[A collection of our family's favorite recipes.]
  ]
]

// ── Table of Contents ──

#page(numbering: none)[
  #text(font: "Jost*", size: 18pt, weight: "bold", fill: wine-red)[Table of Contents]
  #v(1em)
  #outline(title: none, indent: 1.5em, depth: 2)
]

// ── Recipes ──

#set page(footer: context {
  align(center)[#text(font: "Jost*", size: 9pt, fill: muted)[#counter(page).display("1")]]
})
#counter(page).update(1)

<%- recipes_by_category.each do |category, recipes| -%>
#page[#align(center + horizon)[
  #line(length: 20%, stroke: 0.5pt + wine-red)
  #v(0.75em)
  = <%= typst_escape.call(category) %>
  #v(0.75em)
  #line(length: 20%, stroke: 0.5pt + wine-red)
]]

<%- recipes.each do |recipe| -%>
== <%= typst_escape.call(recipe.title) %> <<%= recipe.id %>>
<%- if recipe.description -%>

_<%= typst_escape.call(recipe.description) %>_
<%- end -%>
<%- meta_parts = [recipe.category] -%>
<%- meta_parts << "Makes #{recipe.makes}" if recipe.makes -%>
<%- meta_parts << "Serves #{recipe.serves}" if recipe.serves -%>

#text(size: 10pt, fill: muted)[<%= typst_escape.call(meta_parts.join(' · ')) %>]
<%- recipe.steps.each do |step| -%>
<%- has_ingredients = !step.ingredient_list_items.empty? -%>
<%- has_instructions = step.instructions && !step.instructions.strip.empty? -%>

=== <%= typst_escape.call(step.tldr) %>
<%- if has_ingredients && has_instructions -%>

#grid(
  columns: (9em, 1fr),
  gutter: 1.5em,
  [
    #set text(size: 10pt)
    #set list(marker: text(fill: wine-red, size: 5pt, baseline: 1.5pt)[#sym.circle.filled], indent: 0pt, body-indent: 0.5em)
<%- step.ingredient_list_items.each do |item| -%>
<%- if item.is_a?(CrossReference) -%>
    - *<%= typst_escape.call(item.target_title) %>* (p.~#page-ref(<<%= item.target_slug %>>))<%= item.prep_note ? " #linebreak() #text(size: 9pt, style: \"italic\")[#{typst_escape.call(item.prep_note)}]" : "" %>
<%- else -%>
    - *<%= typst_escape.call(item.name) %>*<%= item.quantity ? ", #{typst_escape.call(item.quantity)}" : "" %><%= item.prep_note ? " #linebreak() #text(size: 9pt, style: \"italic\")[#{typst_escape.call(item.prep_note)}]" : "" %>
<%- end -%>
<%- end -%>
  ],
  [<%= typst_prose.call(step.instructions) %>],
)
<%- elsif has_ingredients -%>

#block[
  #set text(size: 10pt)
  #set list(marker: text(fill: wine-red, size: 5pt, baseline: 1.5pt)[#sym.circle.filled], indent: 0pt, body-indent: 0.5em)
<%- step.ingredient_list_items.each do |item| -%>
<%- if item.is_a?(CrossReference) -%>
  - *<%= typst_escape.call(item.target_title) %>* (p.~#page-ref(<<%= item.target_slug %>>))<%= item.prep_note ? " #linebreak() #text(size: 9pt, style: \"italic\")[#{typst_escape.call(item.prep_note)}]" : "" %>
<%- else -%>
  - *<%= typst_escape.call(item.name) %>*<%= item.quantity ? ", #{typst_escape.call(item.quantity)}" : "" %><%= item.prep_note ? " #linebreak() #text(size: 9pt, style: \"italic\")[#{typst_escape.call(item.prep_note)}]" : "" %>
<%- end -%>
<%- end -%>
]
<%- elsif has_instructions -%>

<%= typst_prose.call(step.instructions) %>
<%- end -%>
<%- end -%>
<%- if recipe.footer -%>

#align(center)[#text(size: 9pt, fill: wine-red)[❇︎]]
#v(0.25em)
#text(style: "italic", size: 10pt, fill: muted)[<%= typst_prose.call(recipe.footer) %>]
<%- end -%>

#pagebreak(weak: true)

<%- end -%>
<%- end -%>
// ── Quick Bites ──

#page[#align(center + horizon)[
  #line(length: 20%, stroke: 0.5pt + wine-red)
  #v(0.75em)
  = Quick Bites
  #v(0.75em)
  #line(length: 20%, stroke: 0.5pt + wine-red)
]]

#columns(2, gutter: 1.5em)[
  #show heading.where(level: 2): it => {
    v(0.5em)
    text(font: "Jost*", size: 11pt, weight: "bold", fill: wine-red, tracking: 0.08em)[#upper(it.body)]
    v(0.2em)
    line(length: 100%, stroke: 0.5pt + rule-color)
    v(0.3em)
  }
<%- quick_bites_by_category.each do |subcategory, bites| -%>
== <%= typst_escape.call(subcategory) %>

<%- bites.each do |bite| -%>
<%- if bite.ingredients.length <= 1 && bite.ingredients.first == bite.title -%>
- *<%= typst_escape.call(bite.title) %>*
<%- else -%>
- *<%= typst_escape.call(bite.title) %>*: <%= bite.ingredients.map { |i| typst_escape.call(i) }.join(', ') %>
<%- end -%>
<%- end -%>

<%- end -%>
]
// ── Ingredient Index ──

#page[#align(center + horizon)[
  #line(length: 20%, stroke: 0.5pt + wine-red)
  #v(0.75em)
  = Ingredient Index
  #v(0.75em)
  #line(length: 20%, stroke: 0.5pt + wine-red)
]]

#columns(2, gutter: 1.5em)[
  #set text(size: 9pt)
<%- ingredient_index.each do |name, recipes| -%>
*<%= typst_escape.call(name) %>* --- <%= recipes.map { |r| "#{typst_escape.call(r.title)} (p.~#page-ref(<#{r.id}>))" }.join(", ") %>

<%- end -%>
]
