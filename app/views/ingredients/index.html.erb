<% content_for(:title) { "#{current_kitchen.name}: Ingredients" } %>

<article class="ingredients-page" data-controller="ingredient-table">
  <header>
    <h1>Ingredients</h1>
  </header>

  <%= render 'ingredients/summary_bar', summary: @summary %>

  <div class="ingredients-toolbar">
    <input type="search" class="ingredients-search"
           placeholder="Search ingredientsâ€¦"
           aria-label="Search ingredients"
           data-ingredient-table-target="searchInput"
           data-action="input->ingredient-table#search"
           autocomplete="off">
    <div class="filter-pills" role="group" aria-label="Filter ingredients">
      <button type="button" class="filter-pill active"
              data-ingredient-table-target="filterButton"
              data-filter="all"
              data-action="click->ingredient-table#filter"
              aria-pressed="true">All</button>
      <button type="button" class="filter-pill"
              data-ingredient-table-target="filterButton"
              data-filter="incomplete"
              data-action="click->ingredient-table#filter"
              aria-pressed="false">Needs Attention</button>
      <button type="button" class="filter-pill"
              data-ingredient-table-target="filterButton"
              data-filter="complete"
              data-action="click->ingredient-table#filter"
              aria-pressed="false">Complete</button>
    </div>
  </div>

  <table class="ingredients-table">
    <thead>
      <tr>
        <th class="col-name">Ingredient</th>
        <th class="col-nutrition" title="Nutrition data">Nutr</th>
        <th class="col-density" title="Density data">Dens</th>
        <th class="col-aisle">Aisle</th>
        <th class="col-recipes">Recipes</th>
      </tr>
    </thead>
    <tbody>
      <% @ingredient_rows.each do |row| %>
        <%= render 'ingredients/table_row', row: row %>
      <% end %>
    </tbody>
  </table>

  <p class="ingredients-count" data-ingredient-table-target="countLabel">
    Showing <%= @ingredient_rows.size %> of <%= @ingredient_rows.size %> ingredients
  </p>

  <% if current_kitchen.member?(current_user) %>
    <%= render layout: 'shared/editor_dialog',
        locals: { title: 'Edit Nutrition',
                  id: 'nutrition-editor',
                  dialog_data: { editor_on_success: 'reload', extra_controllers: 'nutrition-editor' },
                  extra_data: { nutrition_editor_base_url_value: nutrition_entry_upsert_path(ingredient_name: '__NAME__') },
                  footer_extra: render('ingredients/aisle_selector', aisles: @available_aisles) } do %>
      <textarea id="nutrition-editor-textarea" class="editor-textarea" data-editor-target="textarea" data-nutrition-editor-target="textarea" spellcheck="false"></textarea>
    <% end %>
  <% end %>
</article>
